<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard - Debug</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 10px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #ccc;
            background: #f9f9f9;
        }
        .test-result.success {
            border-color: #28a745;
            background: #d4edda;
        }
        .test-result.error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .test-result.warning {
            border-color: #ffc107;
            background: #fff3cd;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0052a3;
        }
    </style>
</head>
<body>
    <h1>ðŸ”§ Dashboard Debug - Test de remontÃ©e de donnÃ©es</h1>
    
    <div class="test-container">
        <h2>1. Test de connexion API</h2>
        <button onclick="testAPIConnection()">Tester la connexion</button>
        <div id="apiConnectionResult"></div>
    </div>
    
    <div class="test-container">
        <h2>2. Test rÃ©cupÃ©ration des posts</h2>
        <button onclick="testGetPosts()">Charger les posts (limit=10)</button>
        <div id="postsResult"></div>
    </div>
    
    <div class="test-container">
        <h2>3. Test des endpoints du dashboard</h2>
        <button onclick="testDashboardEndpoints()">Tester tous les endpoints</button>
        <div id="endpointsResult"></div>
    </div>
    
    <div class="test-container">
        <h2>4. Test du module API.js</h2>
        <button onclick="testAPIModule()">Tester le module API</button>
        <div id="apiModuleResult"></div>
    </div>

    <script type="module">
        const API_BASE = 'http://localhost:8000';
        
        window.testAPIConnection = async function() {
            const resultDiv = document.getElementById('apiConnectionResult');
            resultDiv.innerHTML = '<p>Test en cours...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/posts?limit=1`);
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            <strong>âœ“ Connexion rÃ©ussie</strong><br>
                            Status: ${response.status}<br>
                            DonnÃ©es reÃ§ues: ${data.length} post(s)
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="test-result error">
                            <strong>âœ— Erreur HTTP</strong><br>
                            Status: ${response.status}<br>
                            Message: ${response.statusText}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <strong>âœ— Erreur de connexion</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        };
        
        window.testGetPosts = async function() {
            const resultDiv = document.getElementById('postsResult');
            resultDiv.innerHTML = '<p>Chargement des posts...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/posts?limit=10`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const posts = await response.json();
                
                if (posts && posts.length > 0) {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            <strong>âœ“ Posts rÃ©cupÃ©rÃ©s: ${posts.length}</strong>
                        </div>
                        <h3>Ã‰chantillon (premiers 3 posts):</h3>
                        <pre>${JSON.stringify(posts.slice(0, 3), null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="test-result warning">
                            <strong>âš  Aucun post retournÃ©</strong><br>
                            La base de donnÃ©es est peut-Ãªtre vide.
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <strong>âœ— Erreur</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        };
        
        window.testDashboardEndpoints = async function() {
            const resultDiv = document.getElementById('endpointsResult');
            resultDiv.innerHTML = '<p>Test des endpoints...</p>';
            
            const endpoints = [
                { url: '/posts?limit=5', name: 'Posts' },
                { url: '/api/config', name: 'Config' },
                { url: '/api/pain-points?days=30&limit=5', name: 'Pain Points' },
                { url: '/api/product-opportunities', name: 'Product Opportunities' },
                { url: '/api/improvements-summary', name: 'Improvements Summary' },
            ];
            
            let results = '<h3>RÃ©sultats:</h3>';
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`${API_BASE}${endpoint.url}`);
                    const isOk = response.ok;
                    const status = response.status;
                    
                    results += `
                        <div class="test-result ${isOk ? 'success' : 'error'}">
                            ${isOk ? 'âœ“' : 'âœ—'} ${endpoint.name}: ${status} ${response.statusText}
                        </div>
                    `;
                } catch (error) {
                    results += `
                        <div class="test-result error">
                            âœ— ${endpoint.name}: ${error.message}
                        </div>
                    `;
                }
            }
            
            resultDiv.innerHTML = results;
        };
        
        window.testAPIModule = async function() {
            const resultDiv = document.getElementById('apiModuleResult');
            resultDiv.innerHTML = '<p>Import et test du module API.js...</p>';
            
            try {
                // Import the API module
                const { API } = await import('./dashboard/js/api.js');
                const api = new API();
                
                console.log('API Base URL:', api.baseURL);
                
                // Test getPosts
                const posts = await api.getPosts(5);
                
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        <strong>âœ“ Module API.js fonctionne</strong><br>
                        Base URL: ${api.baseURL}<br>
                        Posts chargÃ©s: ${posts.length}
                    </div>
                    <h3>Ã‰chantillon:</h3>
                    <pre>${JSON.stringify(posts.slice(0, 2), null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <strong>âœ— Erreur module API</strong><br>
                        ${error.message}<br>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        };
    </script>
</body>
</html>
